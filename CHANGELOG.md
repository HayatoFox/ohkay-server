# üìù Changelog - Ohkay

Toutes les modifications notables de ce projet seront document√©es dans ce fichier.

Le format est bas√© sur [Keep a Changelog](https://keepachangelog.com/fr/1.0.0/),
et ce projet adh√®re au [Semantic Versioning](https://semver.org/lang/fr/).

## [1.4.0] - 2025-10-23

### ‚ú® Ajout√© - Serveur

- **Syst√®me de Hi√©rarchie de R√¥les Complet** üëë
  - **getHighestRole()**: R√©cup√®re le r√¥le avec la position la plus √©lev√©e d'un utilisateur
    - Owner retourne position `Number.MAX_SAFE_INTEGER` (position infinie virtuelle)
    - Query optimis√©e avec `ORDER BY position DESC LIMIT 1`
  
  - **canManageRole()**: V√©rification hi√©rarchique pour gestion des r√¥les
    - Owner bypass toutes les v√©rifications
    - Requiert MANAGE_ROLES ou ADMINISTRATOR
    - **Hi√©rarchie stricte**: highest role actor > target role position
    - Protection ADMINISTRATOR: ne peut g√©rer role admin que si on a admin soi-m√™me
    - Retourne `{allowed: boolean, reason?: string}`
  
  - **canModerateUser()**: V√©rification hi√©rarchique pour mod√©ration (kick/ban)
    - Cannot moderate yourself (auto-protection)
    - **Owner intouchable**: Cannot moderate server owner
    - Owner peut mod√©rer n'importe qui (bypass)
    - Requiert permission appropri√©e (KICK_MEMBERS ou BAN_MEMBERS)
    - **Hi√©rarchie stricte**: highest role actor > highest role target
    - Protection ADMINISTRATOR: ne peut mod√©rer admin que si on a admin
    - Retourne `{allowed: boolean, reason?: string}`

- **Int√©gration Hi√©rarchie dans Routes**
  - `PATCH /api/roles/:serverId/roles/:roleId`: V√©rifie hi√©rarchie avant modification r√¥le
  - `DELETE /api/roles/:serverId/roles/:roleId`: V√©rifie hi√©rarchie avant suppression r√¥le
  - `POST /api/roles/:serverId/members/:memberId/roles/:roleId`: V√©rifie hi√©rarchie avant attribution
  - `DELETE /api/roles/:serverId/members/:memberId/roles/:roleId`: V√©rifie hi√©rarchie avant retrait
  - `POST /api/moderation/:serverId/members/:memberId/kick`: V√©rifie hi√©rarchie avant kick
  - `POST /api/moderation/:serverId/bans/:memberId`: V√©rifie hi√©rarchie avant ban
  - Protection owner maintenue partout (owner = intouchable)

- **R√©organisation des R√¥les** üîÑ
  - `PATCH /api/roles/:serverId/roles/reorder`: R√©ordonne plusieurs r√¥les en une transaction
  - Body: `{roleOrders: [{roleId: number, position: number}]}`
  - V√©rifie MANAGE_ROLES pour l'acteur
  - V√©rifie hi√©rarchie pour chaque r√¥le √† d√©placer (via canManageRole)
  - Transaction SQL (BEGIN/COMMIT/ROLLBACK) pour atomicit√©
  - Permet drag & drop dans l'UI

- **Liste Membres avec Tri par R√¥le** üìä
  - `GET /api/members/:serverId/members?sortByRole=true`: Membres tri√©s par highest role DESC
    - R√©cup√®re highest_role_id et highest_role_position pour chaque membre
    - Owner toujours en premier
    - Tri par position de r√¥le d√©croissante
    - Retourne `{members: [], totalCount: number}`
  
  - `GET /api/members/:serverId/members?groupByRole=true`: Membres group√©s par r√¥le hoisted
    - Groupe "owner" en premier (si pr√©sent)
    - Groupes par r√¥les hoisted (is_hoisted=true) tri√©s par position DESC
    - Groupe "noRole" pour membres sans r√¥le hoisted
    - Structure: `{owner: [], roles: [{role: {...}, members: []}], noRole: []}`
    - Parfait pour affichage Discord-like avec s√©parateurs de r√¥le

- **Fichier `routes/members.ts`** (133 lignes)
  - Route GET pour liste membres avec options de tri
  - Int√©gration avec getHighestRole() pour positions
  - Support tri simple et groupement par r√¥le hoisted
  - Enregistr√© dans index.ts sur `/api/members`

### üîß Modifi√© - Serveur

- **routes/roles.ts**: Int√©gration canManageRole dans toutes les routes de gestion
- **routes/moderation.ts**: Int√©gration canModerateUser dans kick/ban
- **routes/permissions.ts**: Ajout 3 helpers (getHighestRole, canManageRole, canModerateUser)
- **index.ts**: Enregistrement route `/api/members` avec memberRoutes

### üìà Statistiques - Hi√©rarchie de R√¥les

- **+200 lignes** de logique hi√©rarchique (3 helpers)
- **+133 lignes** route members avec tri
- **+70 lignes** route reorder
- **6 routes modifi√©es** avec v√©rifications hi√©rarchie
- **Total: ~400 lignes** de code hi√©rarchie

## [1.3.0] - 2025-10-23

### ‚ú® Ajout√© - Client

- **Param√®tres Utilisateur Complets** üéõÔ∏è
  - Modal Settings avec sidebar et tabs (Profil, Voix & Vid√©o, Apparence, Notifications)
  - **Section Profil**:
    - √âdition du nom d'affichage
    - Statut personnalis√© avec emoji (128 caract√®res max)
    - Affichage avatar et informations utilisateur
  - **Section Voix & Vid√©o**:
    - S√©lection p√©riph√©rique d'entr√©e (microphone) avec √©num√©ration automatique
    - S√©lection p√©riph√©rique de sortie (haut-parleurs) avec support setSinkId
    - Sliders de volume entr√©e/sortie (0-100%) appliqu√©s en temps r√©el
    - **Test microphone** avec barre de niveau temps r√©el (vert‚Üíorange‚Üírouge)
    - **√âcoute du retour micro** (monitoring) avec toggle
    - **Test sortie audio** (beep 440Hz) avec volume ajust√©
    - **Auto-mute**: Tests s'arr√™tent automatiquement √† la fermeture des param√®tres
    - Options traitement audio (echo cancellation, noise suppression, auto gain control)
  - Persistence automatique dans localStorage
  - Cleanup automatique des streams audio/micro
  - Bouton ‚öôÔ∏è dans MainLayout pour ouvrir les param√®tres

- **Service Audio Settings** (`audioSettings.ts` - 281 lignes)
  - √ânum√©ration des p√©riph√©riques audio (input/output)
  - Test audio avec AudioContext + OscillatorNode (440Hz sine wave)
  - Test microphone avec AnalyserNode pour d√©tection niveau (FFT 512)
  - Monitoring microphone (connexion au destination pour √©coute retour)
  - Application volumes en temps r√©el via GainNode
  - Cleanup automatique de toutes les ressources

- **Store Settings** (`settingsStore.ts` - 246 lignes)
  - Gestion √©tat complet des param√®tres (profile, voice, appearance, notifications)
  - AudioDevice interface (deviceId, label, kind)
  - VoiceSettings (devices, volumes, processing options, VAD, PTT)
  - AppearanceSettings (theme, compact mode, font size, timestamps)
  - NotificationSettings (sounds, desktop/push notifications, mute)
  - Actions pour tests audio (isTestingAudio, isTestingMicrophone, isMicrophoneMonitoring)
  - Persistence localStorage (loadSettings/saveSettings)

### üìö Documentation - Client

- `USER_SETTINGS_IMPLEMENTATION.md`: Guide complet des param√®tres utilisateur
- `CLIENT_VOICE_IMPLEMENTATION.md`: Documentation syst√®me vocal client
- `VOICE_CLIENT_COMPLETE.md`: R√©capitulatif impl√©mentation vocale compl√®te

## [1.2.0] - 2025-10-23

### ‚ú® Ajout√© - Client

- **Syst√®me Vocal WebRTC Complet** üé§
  - Service vocal (`voice.ts` - 474 lignes) avec mediasoup-client
  - Gestion Device mediasoup pour codecs WebRTC
  - Cr√©ation transports send/recv avec DTLS
  - Production audio local (getUserMedia avec echo cancellation, noise suppression, auto gain)
  - Consommation audio distant (consumers par peer avec audio elements)
  - **Voice Activity Detection** temps r√©el via AudioContext + AnalyserNode
  - Auto-cleanup complet des ressources (transports, consumers, streams)

- **WebSocket Events Vocaux**
  - Listeners pour: `voice:peer-joined`, `voice:peer-left`, `voice:new-producer`
  - Listeners pour: `voice:peer-muted`, `voice:peer-deafened`, `voice:peer-speaking`
  - √âmission: `voice:join`, `voice:leave`, `voice:produce`, `voice:consume`
  - √âmission: `voice:mute`, `voice:deafen`
  - M√©thodes g√©n√©riques `emit()`, `on()`, `off()` dans websocketService

- **Store Vocal** (`voiceStore.ts` - 127 lignes)
  - VoicePeer interface (userId, username, isMuted, isDeafened, isSpeaking, audioElement)
  - √âtat connexion (isConnected, isConnecting, currentVoiceChannelId)
  - √âtat local (isMuted, isDeafened, isSpeaking)
  - Map des peers avec audio elements
  - Actions compl√®tes (addPeer, removePeer, updatePeer, clearPeers)
  - Cleanup automatique des audio elements

- **Composant VoiceControls** (174 lignes + 259 lignes CSS)
  - UI compl√®te avec boutons join/leave
  - Boutons mute/deafen avec √©tats actifs (rouge)
  - Liste des peers avec avatars et initiales
  - Status icons (üîá muted, üîï deafened, üîä speaking)
  - Speaking indicator anim√© avec border verte
  - Connection status avec indicateur "‚Ä¢ Connected"
  - Gestion erreurs avec affichage utilisateur
  - Auto-join au mount, auto-leave au unmount

- **Int√©gration ChannelList**
  - Affichage channels vocaux avec ic√¥ne üîä
  - Click handler pour s√©lection channel vocal
  - Affichage VoiceControls conditionnel
  - Active state pour channel vocal actuel

- **API Endpoints Vocaux**
  - `getRtpCapabilities(serverId, channelId)`: R√©cup√©rer RTP capabilities du router
  - `createTransport(serverId, channelId, direction)`: Cr√©er transport send/recv
  - `connectTransport(serverId, channelId, transportId, dtlsParameters)`: Connecter transport

### ‚ú® Ajout√© - Serveur

- **Syst√®me Vocal Mediasoup SFU** üîä
  - Worker mediasoup avec configuration optimis√©e (ports 7500-8000, 501 ports = ~250 connexions)
  - Router par channel vocal avec codecs Opus/VP8/VP9/H264
  - Transports WebRTC (send/recv) par utilisateur
  - Producers/Consumers avec gestion automatique
  - Broadcasting des nouveaux producers √† tous les peers
  - Cleanup automatique des ressources (transports, producers, consumers)

- **WebSocket Events Vocaux Serveur**
  - `voice:join`: Rejoindre channel vocal
  - `voice:leave`: Quitter channel vocal
  - `voice:produce`: Cr√©er producer
  - `voice:consume`: Consommer producer peer
  - `voice:mute`, `voice:deafen`: √âtats utilisateur
  - Broadcasting: `voice:peer-joined`, `voice:peer-left`, `voice:new-producer`

- **Routes Voice** (`/api/servers/:id/channels/:id/voice/*`)
  - `GET /rtp-capabilities`: R√©cup√©rer RTP capabilities du router
  - `POST /transports`: Cr√©er transport send ou recv
  - `POST /transports/:id/connect`: Connecter transport avec DTLS parameters
  - `POST /produce`: Cr√©er producer audio/video
  - `POST /consume`: Cr√©er consumer pour peer

- **Configuration Audio Optimis√©e**
  - Codec Opus 48kHz stereo, 256kbps
  - FEC (Forward Error Correction) activ√©
  - DTX (Discontinuous Transmission) activ√©
  - NACK, PLI, FIR activ√©s pour r√©cup√©ration erreurs

### üîß Modifi√©

- **Ports WebRTC**: Changement de 10000-10100 ‚Üí 7500-8000 (contrainte ‚â§8100)
  - `docker-compose.yml`: Ports UDP/TCP 7500-8000 mapp√©s
  - `.env.example`: VOICE_RTC_MIN_PORT=7500, VOICE_RTC_MAX_PORT=8000
  - `voice-server.ts`: Defaults √† 7500/8000
  - Documentation: VOICE_SYSTEM.md, CLIENT_IMPLEMENTATION_STATUS.md mis √† jour

- **WebSocket Service** (`websocket.ts`)
  - Ajout m√©thodes g√©n√©riques `emit(event, data)`, `on(event, callback)`, `off(event, callback?)`
  - Support √©v√©nements vocaux en plus des √©v√©nements chat/DM

### üìö Documentation

- `VOICE_SYSTEM.md`: Documentation compl√®te syst√®me vocal serveur
- `CLIENT_VOICE_IMPLEMENTATION.md`: Guide impl√©mentation vocale client
- `VOICE_CLIENT_COMPLETE.md`: R√©capitulatif complet avec tests
- Mise √† jour `CORRECTIONS_APPLIED.md` avec corrections ports
- Mise √† jour `FINAL_VERIFICATION.md` avec v√©rifications vocales

### üì¶ D√©pendances

- **Client**: `mediasoup-client@^3.7.11` (+ 10 packages: h264-profile-level-id, sdp-transform, etc.)
- **Serveur**: `mediasoup@^3.14.19`

### üß™ Tests

- Compilation serveur: ‚úÖ SUCCESS
- Compilation client: ‚úÖ SUCCESS (531.46 kB bundle)
- 0 erreurs TypeScript sur serveur et client

### üìä Statistiques

**Vocal Client**:
- `voice.ts`: 474 lignes
- `voiceStore.ts`: 127 lignes
- `VoiceControls.tsx`: 174 lignes + 259 lignes CSS
- Extensions API/WebSocket: ~56 lignes
- **Total**: ~1090 lignes

**Param√®tres Client**:
- `settingsStore.ts`: 246 lignes
- `audioSettings.ts`: 281 lignes
- `Settings.tsx`: 441 lignes + 440 lignes CSS
- **Total**: ~1408 lignes

**Total Nouveau Code Client**: ~2500 lignes TypeScript + ~700 lignes CSS

## [1.1.0] - 2025-10-23

### ‚ú® Ajout√©

- **Cr√©ation Dynamique de Bases de Donn√©es** üéâ
  - Les bases de donn√©es serveur sont maintenant cr√©√©es automatiquement lors de la cr√©ation d'un serveur
  - Nouvelle m√©thode `DatabaseManager.createServerDatabase()` pour cr√©er physiquement les DB PostgreSQL
  - Initialisation automatique du sch√©ma complet (tables, indexes, fonctions)
  - Rollback automatique en cas d'√©chec de cr√©ation de DB
  - Documentation compl√®te dans `DYNAMIC_DATABASE_CREATION.md`

- **Architecture PostgreSQL Unifi√©**
  - Nouveau fichier `docker-compose.unified.yml` avec un seul conteneur PostgreSQL
  - Script d'initialisation `00-init-databases.sh` pour cr√©er les DB de base
  - Support de plusieurs bases de donn√©es sur le m√™me serveur PostgreSQL
  - Configuration optimis√©e (max_connections=200, shared_buffers=256MB)

- **S√©curit√© Renforc√©e**
  - Chiffrement AES-256-CBC des mots de passe DB dans le registre
  - Variables d'environnement pour credentials admin PostgreSQL (`DB_ADMIN_USER`, `DB_ADMIN_PASSWORD`)
  - Isolation compl√®te des donn√©es entre serveurs

- **Documentation**
  - Guide complet de la cr√©ation dynamique (`DYNAMIC_DATABASE_CREATION.md`)
  - Guide de d√©marrage rapide pour l'architecture unifi√©e (`QUICKSTART_UNIFIED.md`)
  - Script de test PowerShell (`test-dynamic-db.ps1`)
  - Instructions de migration depuis l'architecture s√©par√©e
  - `.env.example` mis √† jour avec les nouvelles variables

### üîß Modifi√©

- `src/utils/database.ts`
  - Ajout de `createServerDatabase()` pour cr√©ation dynamique
  - Ajout de `initializeServerSchema()` pour initialiser le sch√©ma complet
  - Am√©lioration du logging pour les op√©rations de cr√©ation de DB
  
- `src/routes/servers.ts`
  - Impl√©mentation de la cr√©ation physique de DB lors de `POST /api/servers`
  - Ajout de rollback si la cr√©ation de DB √©choue
  - Masquage du mot de passe DB chiffr√© dans les r√©ponses API
  - Utilisation de `dbManager.queryServer()` au lieu de `serverPool.query()`

- `docker-compose.yml`
  - Ajout des variables `DB_HOST`, `DB_PORT`, `DB_ADMIN_USER`, `DB_ADMIN_PASSWORD`

- `README.md`
  - Mention de la fonctionnalit√© de cr√©ation dynamique dans les features

### üêõ Corrig√©

- Correction de l'utilisation directe du pool serveur (maintenant via `dbManager.queryServer()`)
- Gestion correcte des erreurs lors de la cr√©ation de serveur
- Rollback complet (registry + membres) en cas d'√©chec de cr√©ation de DB

### üìö Documentation

- Ajout de commentaires d√©taill√©s dans le code pour la cr√©ation dynamique
- Documentation des variables d'environnement requises
- Exemples de commandes PostgreSQL pour monitoring
- Guide de d√©pannage pour les erreurs courantes

### üß™ Tests

- Nouveau script de test `test-dynamic-db.ps1` pour valider la cr√©ation dynamique
- Tests de cr√©ation de plusieurs serveurs successifs
- V√©rification de l'isolation des donn√©es entre serveurs
- Validation du sch√©ma complet de chaque DB serveur

### üîí S√©curit√©

- Les mots de passe DB sont chiffr√©s avant stockage dans `registry_db`
- Validation des permissions PostgreSQL (`CREATEDB` pour `ohkay_user`)
- Nettoyage automatique en cas d'√©chec de cr√©ation
- Logs d√©taill√©s sans exposer les credentials

### üìä Performance

- Lazy loading des connexions aux DB serveur (cr√©ation √† la demande)
- Pool de connexions par serveur avec gestion optimis√©e
- Index PostgreSQL appropri√©s sur toutes les tables
- Configuration PostgreSQL optimis√©e pour multi-DB

### ‚ö†Ô∏è Notes de Migration

Si vous utilisez l'architecture s√©par√©e actuelle (`docker-compose.yml`), deux options :

1. **Continuer avec l'architecture s√©par√©e** : Aucun changement requis, mais pas de cr√©ation dynamique
2. **Migrer vers l'architecture unifi√©e** : Suivre le guide dans `DYNAMIC_DATABASE_CREATION.md` section "Migration"

L'architecture unifi√©e est **recommand√©e** pour :
- Facilit√© de gestion
- Moins de ressources
- Cr√©ation dynamique de serveurs
- Scalabilit√©

---

## [1.0.0] - 2025-10-22

### ‚ú® Version Initiale - Syst√®me de Permissions Complet

#### **49 Permissions Flags Impl√©ment√©es** üîê

**Permissions G√©n√©rales du Serveur**:
- `ADMINISTRATOR` (0x1): Toutes permissions, bypass channel overrides
- `VIEW_AUDIT_LOG` (0x2): Voir les logs d'audit
- `MANAGE_GUILD` (0x4): Modifier nom, description, r√©gion serveur
- `MANAGE_ROLES` (0x8): Cr√©er, modifier, supprimer, attribuer r√¥les
- `MANAGE_CHANNELS` (0x10): Cr√©er, modifier, supprimer channels
- `KICK_MEMBERS` (0x20): Expulser membres du serveur
- `BAN_MEMBERS` (0x40): Bannir/d√©bannir membres
- `CREATE_INSTANT_INVITE` (0x80): Cr√©er liens d'invitation
- `CHANGE_NICKNAME` (0x100): Changer son propre pseudo
- `MANAGE_NICKNAMES` (0x200): Changer pseudo des autres membres
- `MANAGE_GUILD_EXPRESSIONS` (0x400): Cr√©er, modifier, supprimer emojis custom
- `CREATE_GUILD_EXPRESSIONS` (0x800): Cr√©er emojis custom seulement
- `VIEW_GUILD_INSIGHTS` (0x1000): Voir statistiques du serveur
- `MANAGE_WEBHOOKS` (0x2000): Cr√©er, modifier, supprimer webhooks

**Permissions Channels**:
- `VIEW_CHANNEL` (0x4000): Voir le channel
- `MANAGE_MESSAGES` (0x8000): Supprimer/√©pingler messages des autres
- `SEND_MESSAGES` (0x10000): Envoyer messages
- `SEND_TTS_MESSAGES` (0x20000): Envoyer messages TTS
- `EMBED_LINKS` (0x40000): Liens automatiquement transform√©s en embeds
- `ATTACH_FILES` (0x80000): Uploader fichiers/images
- `READ_MESSAGE_HISTORY` (0x100000): Voir historique messages
- `MENTION_EVERYONE` (0x200000): Mention @everyone et @here
- `USE_EXTERNAL_EMOJIS` (0x400000): Utiliser emojis d'autres serveurs
- `ADD_REACTIONS` (0x800000): Ajouter r√©actions aux messages
- `USE_SLASH_COMMANDS` (0x1000000): Utiliser commandes slash
- `MANAGE_THREADS` (0x2000000): Cr√©er, supprimer, archiver threads
- `CREATE_PUBLIC_THREADS` (0x4000000): Cr√©er threads publics
- `CREATE_PRIVATE_THREADS` (0x8000000): Cr√©er threads priv√©s
- `USE_EXTERNAL_STICKERS` (0x10000000): Utiliser stickers d'autres serveurs
- `SEND_MESSAGES_IN_THREADS` (0x20000000): Envoyer dans threads
- `SEND_VOICE_MESSAGES` (0x40000000): Envoyer messages vocaux

**Permissions Vocales**:
- `CONNECT` (0x80000000): Se connecter au channel vocal
- `SPEAK` (0x100000000): Parler dans le channel
- `MUTE_MEMBERS` (0x200000000): Mute d'autres membres
- `DEAFEN_MEMBERS` (0x400000000): Deafen d'autres membres
- `MOVE_MEMBERS` (0x800000000): D√©placer membres entre channels vocaux
- `USE_VAD` (0x1000000000): Utiliser Voice Activity Detection
- `PRIORITY_SPEAKER` (0x2000000000): Voix prioritaire (plus fort)
- `STREAM` (0x4000000000): Partager √©cran/stream vid√©o
- `USE_EMBEDDED_ACTIVITIES` (0x8000000000): Utiliser activit√©s int√©gr√©es
- `USE_SOUNDBOARD` (0x10000000000): Utiliser soundboard
- `USE_EXTERNAL_SOUNDS` (0x20000000000): Utiliser sons externes

**Permissions Avanc√©es**:
- `REQUEST_TO_SPEAK` (0x40000000000): Demander parole (stage channels)
- `MANAGE_EVENTS` (0x80000000000): Cr√©er, modifier √©v√©nements
- `MODERATE_MEMBERS` (0x100000000000): Timeout membres
- `VIEW_CREATOR_MONETIZATION_ANALYTICS` (0x200000000000): Voir analytics mon√©tisation
- `USE_CLYDE_AI` (0x400000000000): Utiliser Clyde AI
- `SET_VOICE_CHANNEL_STATUS` (0x800000000000): D√©finir statut channel vocal
- `SEND_POLLS` (0x1000000000000): Cr√©er sondages
- `USE_EXTERNAL_APPS` (0x2000000000000): Utiliser apps externes

#### **Syst√®me de Permissions Impl√©ment√©** ‚öôÔ∏è

**Fichier `permissions-flags.ts`** (382 lignes):
- 49 permissions en bitwise avec BigInt (jusqu'√† 2^48)
- `DEFAULT_PERMISSIONS`: Permissions de base pour @everyone
- `OWNER_PERMISSIONS`: Toutes permissions pour le propri√©taire
- `hasPermission()`: V√©rifie si une permission est active (bitwise AND)
- `permissionsToBigInt()`: Convertit BigInt ‚Üí string pour PostgreSQL
- `bigIntToPermissions()`: Convertit string ‚Üí BigInt
- Export complet de tous les flags

**Fichier `permissions.ts` (292 lignes)**:
- `checkServerMembership`: Middleware v√©rification membre du serveur
- `checkServerOwnership`: Middleware v√©rification propri√©taire
- `checkDMAccess`: Middleware v√©rification acc√®s DM
- `getUserPermissions()`: Calcule permissions compl√®tes d'un user
  - Combine @everyone + tous les r√¥les de l'utilisateur (bitwise OR)
  - Si ADMINISTRATOR ‚Üí retourne toutes permissions
  - Owner ‚Üí retourne OWNER_PERMISSIONS
- `getUserChannelPermissions()`: Calcule permissions dans un channel
  - R√©cup√®re permissions de base du serveur
  - Applique overrides du channel (r√¥les puis user)
  - G√®re ALLOW/DENY avec priorit√©s Discord
  - Owner et ADMINISTRATOR bypass tout

**Routes de Gestion Permissions**:
- `GET /api/permissions/:serverId/members/:memberId`: Permissions compl√®tes membre
- `GET /api/permissions/:serverId/channels/:channelId/members/:memberId`: Permissions channel
- `POST /api/permissions/:serverId/channels/:channelId/overrides`: Cr√©er override (role/user)
- `DELETE /api/permissions/:serverId/channels/:channelId/overrides`: Supprimer override
- Requiert MANAGE_ROLES ou MANAGE_CHANNELS pour g√©rer overrides

#### **Int√©gration Permissions dans Routes** üîó

**Serveurs** (`servers.ts`):
- `PATCH /api/servers/:serverId`: MANAGE_GUILD pour modifier serveur
- Protection owner maintenue en fallback

**Channels** (`channels.ts`):
- `POST /api/servers/:serverId/channels`: MANAGE_CHANNELS pour cr√©er channel
- `PATCH /api/servers/:serverId/channels/:channelId`: MANAGE_CHANNELS pour modifier
- `DELETE /api/servers/:serverId/channels/:channelId`: MANAGE_CHANNELS pour supprimer
- `PATCH /api/channels/:serverId/channels/:channelId/messages/:messageId`: MANAGE_MESSAGES ou message own
- `DELETE /api/channels/:serverId/channels/:channelId/messages/:messageId`: MANAGE_MESSAGES ou message own

**Messages** (`socket/handlers.ts`):
- `send_message`: SEND_MESSAGES pour envoyer
- `send_message`: ATTACH_FILES si fichiers attach√©s
- `send_message`: USE_EXTERNAL_EMOJIS si emojis custom externes
- Extraction et validation emojis via `canUseEmojis()`

**R√©actions** (`reactions.ts`):
- `POST /add`: ADD_REACTIONS pour ajouter r√©action
- `POST /add`: USE_EXTERNAL_EMOJIS si emoji externe + validation membre serveur emoji

**Fichiers** (`attachments.ts`):
- `POST /upload`: ATTACH_FILES pour upload
- Cleanup fichier si permission refus√©e

**Invitations** (`invites.ts`):
- `POST /create`: CREATE_INSTANT_INVITE pour cr√©er invitation
- Configuration maxUses, expiresInHours

**R√¥les** (`roles.ts`):
- `POST /create`: MANAGE_ROLES (ou owner) pour cr√©er r√¥le
- `PATCH /update`: MANAGE_ROLES pour modifier
- `DELETE /delete`: MANAGE_ROLES pour supprimer (sauf @everyone)
- `POST /assign`: MANAGE_ROLES pour attribuer r√¥le
- `DELETE /remove`: MANAGE_ROLES pour retirer r√¥le

**Mod√©ration** (`moderation.ts`):
- `POST /kick`: KICK_MEMBERS (protection owner + self-kick)
- `POST /ban`: BAN_MEMBERS (protection owner + self-ban)
- `DELETE /unban`: BAN_MEMBERS pour d√©bannir
- `PATCH /nickname`: MANAGE_NICKNAMES pour changer pseudo autres
- `PATCH /nickname`: CHANGE_NICKNAME pour changer son pseudo
- Audit log automatique pour toutes actions

**Emojis** (`emojis.ts`):
- `POST /create`: MANAGE_GUILD_EXPRESSIONS ou CREATE_GUILD_EXPRESSIONS
- `DELETE /delete`: MANAGE_GUILD_EXPRESSIONS
- `PATCH /update`: MANAGE_GUILD_EXPRESSIONS
- Cleanup fichier si permission refus√©e

#### **Protections Impl√©ment√©es** üõ°Ô∏è

1. **Owner Protection**: Owner ne peut jamais √™tre kick/ban/mod√©r√©
2. **Self-Action Protection**: Ne peut pas se kick/ban soi-m√™me
3. **@everyone Protection**: R√¥le @everyone ne peut pas √™tre supprim√©
4. **Administrator Bypass**: ADMINISTRATOR bypass channel overrides mais pas ownership
5. **File Cleanup**: Fichiers upload√©s supprim√©s si permission refus√©e

#### **Base de Donn√©es** üíæ

**Table `roles`**:
- `permissions VARCHAR(20)`: Bitfield 64-bit stock√© en string
- `position INTEGER`: Position dans hi√©rarchie (non utilis√©e en 1.0.0)
- `is_default BOOLEAN`: Marque le r√¥le @everyone
- `is_hoisted BOOLEAN`: Affichage s√©par√© dans liste membres
- `is_mentionable BOOLEAN`: Peut √™tre mentionn√©

**Table `member_roles`**:
- Relation many-to-many entre users et roles
- `PRIMARY KEY (user_id, role_id)`

**Table `channel_permission_overrides`**:
- Overrides par channel pour roles ou users
- `target_type ENUM('role', 'user')`
- `allow VARCHAR(20)`: Permissions autoris√©es (bitfield)
- `deny VARCHAR(20)`: Permissions refus√©es (bitfield)
- Priorit√©: User overrides > Role overrides > Base permissions

**Table `audit_log`**:
- Log toutes actions de mod√©ration
- `action VARCHAR(50)`: Type action (MEMBER_KICK, MEMBER_BAN, etc.)
- `user_id INT`: Qui a fait l'action
- `target_user_id INT`: Cible de l'action
- `reason TEXT`: Raison optionnelle

#### **Documentation** üìö

- `PERMISSIONS_VERIFICATION.md`: Audit complet de 42 routes avec v√©rifications
- Commentaires d√©taill√©s dans tous les fichiers de permissions
- Exemples d'utilisation des flags bitwise

#### **Statistiques** üìä

- **49 permissions** d√©finies avec bitwise operations
- **42 routes** v√©rifi√©es avec checks de permissions
- **10 fichiers** de routes int√©gr√©s
- **5 protections** majeures impl√©ment√©es
- **~1000 lignes** de code permissions (flags + routes + helpers)

---

### ‚ú® Version Initiale - Base

- Architecture multi-base de donn√©es (auth, dm, registry, servers)
- API REST compl√®te pour authentification, serveurs, channels, DMs
- WebSocket temps r√©el avec Socket.io
- Messages avec √©dition, √©pinglage, r√©ponses
- R√©actions et attachments
- Webhooks pour int√©grations
- Logging complet avec Winston
- Docker Compose avec bases de donn√©es s√©par√©es
- S√©curit√© (JWT, bcrypt, helmet, rate limiting)
- Health checks et graceful shutdown

---

## Format du Changelog

### Types de modifications

- **Ajout√©** : Nouvelles fonctionnalit√©s
- **Modifi√©** : Changements dans les fonctionnalit√©s existantes
- **D√©pr√©ci√©** : Fonctionnalit√©s bient√¥t supprim√©es
- **Supprim√©** : Fonctionnalit√©s supprim√©es
- **Corrig√©** : Corrections de bugs
- **S√©curit√©** : Corrections de vuln√©rabilit√©s

### Ic√¥nes

- ‚ú® Nouvelle fonctionnalit√©
- üîß Modification
- üêõ Correction de bug
- üîí S√©curit√©
- üìö Documentation
- üß™ Tests
- üìä Performance
- ‚ö†Ô∏è Important / Breaking change
- üéâ Version majeure
